<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place List and Detail</title>
    <!-- Google Maps API 스크립트 추가 -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPRAME5ZhySmydx9zsgIZwPkTD6MclT1Y&callback=initMap"></script>
</head>
<body>

    <h1>Place List and Detail</h1>

    <ul id="placeList"></ul>
    <div id="placeDetail"></div>
    <!-- 맵을 표시할 div 추가 -->
    <div id="map" style="width: 500px; height: 500px;"></div>

    <script>
        // 전역 변수로 맵 객체 선언
        let map;

        document.addEventListener('DOMContentLoaded', function () {
            const placeListContainer = document.getElementById('placeList');
            const placeDetailContainer = document.getElementById('placeDetail');
            
            // Google Maps 초기화 함수
            window.initMap = function () {
                // 맵 객체 생성
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 0, lng: 0}, // 초기 중심 좌표
                    zoom: 2 // 초기 줌 레벨
                });
            };

            // Fetch를 사용하여 Place 목록 가져오기
            fetch('http://localhost:8000/place/api/places/')
                .then(response => response.json())
                .then(data => {
                    // Place 목록 생성
                    const placeList = document.createElement('ul');
                    data.forEach(place => {
                        const placeItem = document.createElement('li');
                        const placeLink = document.createElement('a');
                        placeLink.href = `javascript:void(0);`;
                        placeLink.textContent = place.name;
                        placeLink.onclick = function () {
                            showPlaceDetail(place.id);
                        };
                        placeItem.appendChild(placeLink);
                        placeList.appendChild(placeItem);
                        
                        // Place 목록에 해당하는 마커를 지도에 추가
                        addMarker(place);
                    });
                    placeListContainer.appendChild(placeList);
                })
                .catch(error => console.error('Error fetching place list:', error));

            // 선택한 Place의 ID로 상세 정보 보여주기
            window.showPlaceDetail = function (placeId) {
                // Fetch를 사용하여 선택한 ID의 Place 상세 정보 가져오기
                fetch(`http://localhost:8000/place/api/places/${placeId}/`)
                    .then(response => response.json())
                    .then(place => {
                        // Place 상세 정보 생성
                        const placeDetail = document.createElement('div');
                        placeDetail.innerHTML = `
                            <h2>${place.name}</h2>
                            <p>Description: ${place.description}</p>
                            <p>Category: ${place.category}</p>
                            <p>Coordinates: ${place.latitude}, ${place.longitude}</p>
                            <img src="${place.photo}" alt="${place.name} Photo" style="max-width: 300px; max-height: 300px;">
                        `;

                        // 기존 상세 정보 삭제 후 새로운 정보로 갱신
                        placeDetailContainer.innerHTML = '';
                        placeDetailContainer.appendChild(placeDetail);
                        
                        // 선택한 Place의 위치로 맵 이동
                        map.setCenter({lat: place.latitude, lng: place.longitude});
                        map.setZoom(15); // 예시로 줌 레벨을 15로 설정
                    })
                    .catch(error => console.error('Error fetching place detail:', error));
            };

            // Place에 해당하는 마커를 지도에 추가하는 함수
            function addMarker(place) {
                const marker = new google.maps.Marker({
                    position: {lat: place.latitude, lng: place.longitude},
                    map: map,
                    title: place.name
                });
            }
        });
    </script>

</body>
</html>
