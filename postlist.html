<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 장소 API </title>
    <!-- Google Maps API 스크립트 추가 -->
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUzWM4L4iAj-krLKiEx3MkD-j0HrqlNrs&libraries=places"></script>
</head>
<body>
    <h1> 장소 리스트 </h1>

    <!-- 장소 목록 -->
    <h2>등록된 장소 목록</h2>
    <ul id="places-list"></ul>

    <!-- Google Map을 표시할 영역 -->
    <div id="map-container" style="height: 400px;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const placesList = document.getElementById('places-list');
            const mapContainer = document.getElementById('map-container');
            const apiBaseUrl = 'http://localhost:8000/place/api/';

            async function loadPlacesList() {
                const response = await fetch(apiBaseUrl + 'places/');
                const data = await response.json();

                placesList.innerHTML = '';
                data.forEach(place => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${place.name} - ${place.address} - ${place.content}`;

                    // 클릭 이벤트 추가: Google Map에 마커 표시
                    listItem.addEventListener('click', function () {
                        showOnMap(place);
                    });

                    placesList.appendChild(listItem);
                });
            }

            function showOnMap(place) {
                // Google Map에 표시할 좌표
                const location = { lat: place.latitude, lng: place.longitude };

                // Google Map 생성
                const map = new google.maps.Map(mapContainer, {
                    center: location,
                    zoom: 15,
                });

                // 마커 생성
                const marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    title: place.name,
                });

                // 정보창 생성
                const infowindow = new google.maps.InfoWindow({
                    content: `<strong>${place.name}</strong><br>${place.address}<br>${place.content}`,
                });

                // 마커 클릭 이벤트: 정보창 열기
                marker.addListener('click', function () {
                    infowindow.open(map, marker);
                });
            }

            loadPlacesList();
        });
    </script>
</body>
</html>
