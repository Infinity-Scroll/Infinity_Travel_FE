<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>일정 페이지</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.1/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../dist/output.css" />
</head>

<body class="flex min-h-screen flex-col bg-white">
  <header class="fixed left-0 right-0 top-0 z-50 bg-gray-200 p-6">
    <nav class="flex items-center justify-between">
      <div class="logo"><a href="./index.html">Infinity Scroll</a></div>
      <ul class="ml-8 flex space-x-4">
        <li><a href="./companion.html">동행</a></li>
        <li><a href="./planner.html">일정</a></li>
      </ul>
      <div class="login-icons ml-auto">
        <a href="./profile.html">마이페이지</a>
        <a href="./login.html">로그인</a>
        <span> | </span>
        <a href="./signup.html">회원가입</a>
        <a href="">글쓰기</a>
      </div>
    </nav>
  </header>

  <body class="flex min-h-screen flex-col bg-white">
    <!-- Schedule Section -->
    <section class="container mx-auto mt-20 p-4">
      <h1 class="text-3xl font-bold mb-4">일정 페이지</h1>

      <!-- Display schedule data here -->
      <div id="map" class="w-full h-64 mb-4"></div>

      <div id="planners-list" class="flex flex-wrap space-x-4">
        <!-- Insert dynamic content here using JavaScript -->
      </div>
    </section>

    <footer class="mt-auto bg-gray-100 p-4 text-center">
      <div class="container mx-auto">
        <p>&copy; 2023 Infinity Scroll. All rights reserved.</p>
      </div>
    </footer>

    <!-- 스크립트 -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPRAME5ZhySmydx9zsgIZwPkTD6MclT1Y&libraries=places&callback=initMap" async defer></script>

    <!-- 데이터를 가져오고 표시하기 위한 JavaScript 코드 추가 -->
    <script>
      async function initMap(latitude, longitude, area) {
        // 좌표가 유효한 숫자인지 확인합니다.
        if (typeof latitude !== 'number' || isNaN(latitude) || typeof longitude !== 'number' || isNaN(longitude)) {
          console.error('유효하지 않은 좌표: 위도와 경도는 유효한 숫자여야 합니다.');
          return;
        }
        console.log(latitude + " : 경도")
        console.log(longitude + " : 위도")
        var coordinates = { lat: latitude, lng: longitude };
        
        var map = new google.maps.Map(document.getElementById('map'), {
          center: coordinates,
          zoom: 10
        });
        var marker = new google.maps.Marker({ 
          position: coordinates, 
          map: map,
          title: area });
      }

      document.addEventListener('DOMContentLoaded', function () {
        // 실제 DRF API URL로 'YOUR_API_URL'을 교체합니다.
        var apiUrl = 'http://localhost:8000/schedule/api/planners/7/';

        // DRF API에서 데이터 가져오기
        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            // API 응답을 받은 후에 initMap 호출
            initMap(data.period_events[0].latitude, data.period_events[0].longitude, data.area);

            // 플래너 목록 업데이트
            updatePlannersList(data);
          })
          .catch(error => console.error('데이터 가져오기 오류:', error));

        // 플래너 목록 업데이트 함수
        function updatePlannersList(data) {
          var plannersList = document.getElementById('planners-list');

          // 플래너 아이템 생성
          var plannerItem = document.createElement('div');
          plannerItem.className = 'planner-item';

          // 플래너 데이터 채우기
          plannerItem.innerHTML = `
            <h2>${data.name}</h2>        
            <p>지역: ${data.area}</p>
            <p>날짜 범위: ${data.start_date} ~ ${data.end_date}</p>
          `;

          // 날짜 이벤트 생성 및 채우기
          var dateEventsList = document.createElement('ul');
          data.period_events[0].date_events.forEach(dateEvent => {
            var dateEventItem = document.createElement('li');
            var placeName = dateEvent.place.length > 0 ? dateEvent.place[0].name : '장소 선택 안 함';
            dateEventItem.innerHTML = `
              ${dateEvent.event_date} - ${placeName}
              <!-- [장소 선택] 버튼을 누르면 해당 날짜 이벤트의 ID를 전달 -->
              <button onclick="openPlaceSelect(${dateEvent.id})">장소 선택</button>
            `;
            dateEventsList.appendChild(dateEventItem);
          });

          // 날짜 이벤트를 플래너 아이템에 추가
          plannerItem.appendChild(dateEventsList);

          // 플래너 아이템을 플래너 목록에 추가
          plannersList.appendChild(plannerItem);
        }

        // 장소 선택 페이지로 이동
        window.openPlaceSelect = function (dateEventId) {
          // 페이지 이동
          window.location.href = `./place_select.html?dateEventId=${dateEventId}`;
        };
      });
    </script>
  </body>

